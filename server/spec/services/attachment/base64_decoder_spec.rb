require 'rails_helper'

describe Attachment::Base64Decoder do
  context 'when input is valid' do
    let(:base64_string) { get_attachment_base64 }

    describe '#split_content' do
      subject { described_class.split_content(base64_string) }

      it 'remove the header' do
        is_expected.to eq(hongjpg_base64)
      end

      it { is_expected.not_to include("\n") }
    end

    describe '#perform' do
      subject { described_class.perform(base64_string) }

      let(:bin) do
        filepath = Rails.root.join('spec', 'factories', 'files', 'hong.jpg')
        File.open(filepath, 'rb', &:read)
      end

      it 'decode to binary' do
        is_expected.to eq(bin)
      end
    end
  end

  # TODO: fail cases

  def hongjpg_base64
    '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'
  end
end
